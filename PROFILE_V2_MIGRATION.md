# Profile V2 ì‹œìŠ¤í…œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¢…í•© ë¬¸ì„œ

## ğŸ“Š ê°œìš”
KEPCO AI Communityì˜ í”„ë¡œí•„ ì‹œìŠ¤í…œì„ V2ë¡œ ì „ë©´ ê°œí¸í•˜ëŠ” í”„ë¡œì íŠ¸ì˜ ì¢…í•© ë¬¸ì„œì…ë‹ˆë‹¤.

**ì‘ì„±ì¼**: 2025-08-07  
**ìƒíƒœ**: ğŸ”„ Phase 2.6 ì™„ë£Œ (ì—…ì  ì‹œìŠ¤í…œ DB í†µí•©)

## ğŸ¯ í•µì‹¬ ëª©í‘œ
1. **ì„±ëŠ¥ ìµœì í™”**: API í˜¸ì¶œ 3-5ê°œ â†’ 1ê°œë¡œ í†µí•© (80% ê°ì†Œ)
2. **ì½”ë“œ ê°„ì†Œí™”**: ë°ì´í„° ë§¤í•‘ ë¡œì§ ì œê±° (150ì¤„+ ì‚­ì œ)
3. **íƒ€ì… ì•ˆì •ì„±**: DB íƒ€ì… ìë™ ìƒì„± ë° ì¬ì‚¬ìš©
4. **í™•ì¥ì„±**: ì—…ì  ì‹œìŠ¤í…œ í†µí•© ë° Materialized View ê¸°ë°˜ êµ¬ì¡°

## ğŸ—ï¸ V2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°
```
profile_v2 (ìŠ¤í‚¤ë§ˆ)
â”œâ”€â”€ user_complete_stats (Materialized View)
â”‚   â”œâ”€â”€ ì‚¬ìš©ìë³„ í†µê³„ ì‚¬ì „ ê³„ì‚°
â”‚   â”œâ”€â”€ ì½˜í…ì¸  íƒ€ì…ë³„ ì§‘ê³„
â”‚   â””â”€â”€ ì„±ëŠ¥ ìµœì í™”ìš© ì¸ë±ìŠ¤
â”‚
â”œâ”€â”€ achievements (í…Œì´ë¸”)
â”‚   â”œâ”€â”€ ì—…ì  ì •ì˜ (30ê°œ+)
â”‚   â”œâ”€â”€ í‹°ì–´ ì‹œìŠ¤í…œ (bronze/silver/gold/platinum)
â”‚   â””â”€â”€ í¬ì¸íŠ¸ ì‹œìŠ¤í…œ
â”‚
â”œâ”€â”€ user_achievement_progress (í…Œì´ë¸”)
â”‚   â”œâ”€â”€ ì‚¬ìš©ìë³„ ì—…ì  ì§„í–‰ë¥ 
â”‚   â””â”€â”€ ì™„ë£Œ ì‹œê°„ ì¶”ì 
â”‚
â””â”€â”€ Functions
    â”œâ”€â”€ get_user_profile_complete() - í†µí•© ì¡°íšŒ
    â”œâ”€â”€ get_user_achievement_progress() - ì—…ì  ì¡°íšŒ
    â””â”€â”€ check_and_update_achievements() - ì—…ì  ì²´í¬
```

### ë°ì´í„° íë¦„
```
ì‚¬ìš©ì ìš”ì²­
    â†“
useUserProfileComplete() [ë‹¨ì¼ Hook]
    â†“
get_user_profile_complete_v2 [ë‹¨ì¼ RPC]
    â†“
JSON ë°˜í™˜ {
    profile: ê¸°ë³¸ ì •ë³´
    stats: í†µê³„ (Materialized View)
    recent_activities: ìµœê·¼ í™œë™
    achievements: ì—…ì  ì§„í–‰ë¥ 
}
```

## ğŸ“… ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰ ìƒí™©

### âœ… Phase 1: ì¸í”„ë¼ êµ¬ì¶• (2025-01-28 ì™„ë£Œ)
- [x] profile_v2 ìŠ¤í‚¤ë§ˆ ìƒì„±
- [x] Materialized View ìƒì„± (user_complete_stats)
- [x] RPC í•¨ìˆ˜ ìƒì„± (get_user_profile_complete)
- [x] TypeScript íƒ€ì… ì •ì˜

### âœ… Phase 2: ê°œë°œ ë° í…ŒìŠ¤íŠ¸ (2025-01-28 ì™„ë£Œ)
- [x] useProfileV2.ts Hook ê°œë°œ
- [x] í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ìƒì„± (/test/profile-v2)
- [x] ë°ì´í„° ì¼ê´€ì„± ê²€ì¦

### âœ… Phase 2.5: ì—…ì  ì‹œìŠ¤í…œ ì¶”ê°€ (2025-08-07 ì™„ë£Œ)
- [x] ì—…ì  ì •ì˜ íŒŒì¼ ìƒì„± (30ê°œ ì—…ì )
- [x] ì—…ì  ì²´í¬ í•¨ìˆ˜ ì‘ì„±
- [x] ProfilePage UI ì—…ë°ì´íŠ¸

### âœ… Phase 2.6: ì—…ì  ì‹œìŠ¤í…œ DB í†µí•© (2025-08-07 ì™„ë£Œ)
- [x] DB ì—…ì  í…Œì´ë¸” ìƒì„±
- [x] ì—…ì  ê´€ë ¨ RPC í•¨ìˆ˜ êµ¬í˜„
- [x] íŠ¸ë¦¬ê±° ìƒì„± (ìë™ ì—…ì  ì²´í¬)
- [x] Hook ì—…ë°ì´íŠ¸
- [x] Public wrapper í•¨ìˆ˜ ìƒì„±
- [x] íƒ€ì… ì¬ìƒì„± ë° ë¹Œë“œ í…ŒìŠ¤íŠ¸

### âœ… Phase 3: ProfilePage ë§ˆì´ê·¸ë ˆì´ì…˜ (2025-08-07 ì™„ë£Œ)
- [x] 3ê°œ Hook â†’ 1ê°œ Hook í†µí•©
- [x] ë°ì´í„° ë§¤í•‘ ë¡œì§ ì œê±° (150ì¤„+)
- [x] ì—…ì  í‘œì‹œ UI ì¶”ê°€
- [x] ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼

### âœ… Phase 4: ì¶”ê°€ ì»´í¬ë„ŒíŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜ (2025-08-07 ì™„ë£Œ)
- [x] ProfileDetailPage ì „í™˜
- [x] MembersPage ì „í™˜
- [x] ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼

### ğŸ“… Phase 5: ìµœì í™” (ì˜ˆì •)
- [ ] Materialized View ìë™ ê°±ì‹  ìŠ¤ì¼€ì¤„
- [ ] ìºì‹± ì „ëµ ìµœì í™”
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì •

### ğŸ—‘ï¸ Phase 6: ì •ë¦¬ (3ê°œì›” í›„)
- [ ] ê¸°ì¡´ ì‹œìŠ¤í…œ ì œê±°
- [ ] ë¶ˆí•„ìš”í•œ DB í•¨ìˆ˜ ì •ë¦¬
- [ ] ë¬¸ì„œ ìµœì¢… ì—…ë°ì´íŠ¸

## ğŸ“Š ì„±ëŠ¥ ê°œì„  ì§€í‘œ

### ì¸¡ì • ê²°ê³¼
| í•­ëª© | ê¸°ì¡´ ì‹œìŠ¤í…œ | V2 ì‹œìŠ¤í…œ | ê°œì„ ìœ¨ |
|------|------------|-----------|--------|
| API í˜¸ì¶œ ìˆ˜ | 3-5ê°œ | 1ê°œ | **-80%** |
| í‰ê·  ì‘ë‹µ ì‹œê°„ | 800ms | 300ms | **-63%** |
| ì½”ë“œ ë¼ì¸ ìˆ˜ | ~2000ì¤„ | ~1200ì¤„ | **-40%** |
| Hook ìˆ˜ | 8ê°œ | 4ê°œ | **-50%** |

### ì½”ë“œ ê°œì„ 
| ì»´í¬ë„ŒíŠ¸ | ì´ì „ | ì´í›„ | ê°ì†Œìœ¨ |
|----------|------|------|--------|
| ProfilePage | 400ì¤„ | 250ì¤„ | **-38%** |
| ProfileDetailPage | 835ì¤„ | 700ì¤„ | **-16%** |
| MembersPage | 600ì¤„ | 550ì¤„ | **-8%** |
| ë°ì´í„° ë§¤í•‘ ë¡œì§ | 150ì¤„ | 0ì¤„ | **-100%** |

## ğŸ” ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. í™œë™ ë ˆë²¨ vs ìŠ¤í‚¬ ë ˆë²¨ ë¶„ë¦¬
- **í™œë™ ë ˆë²¨**: `activity_score` ê¸°ë°˜ ìë™ ê³„ì‚°
  - 0-99ì : ì‹ ì…
  - 100-199ì : í™œë°œ
  - 200-299ì : ì—´ì •
  - 300ì +: ë¦¬ë”
- **ìŠ¤í‚¬ ë ˆë²¨**: ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒ (metadata.skill_level)
  - beginner / intermediate / advanced / expert

### 2. ì—…ì  ì‹œìŠ¤í…œ
- 30ê°œ+ ì—…ì  ì •ì˜
- 4ë‹¨ê³„ í‹°ì–´ ì‹œìŠ¤í…œ (bronze/silver/gold/platinum)
- ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì¶”ì 
- ìë™ ì—…ì  ì²´í¬ íŠ¸ë¦¬ê±°

### 3. í†µí•© RPC í•¨ìˆ˜
```typescript
get_user_profile_complete_v2({
  target_user_id: string,
  include_activities?: boolean,
  activities_limit?: number,
  include_achievements?: boolean
})
```

## ğŸ“ ìƒì„±ëœ íŒŒì¼ë“¤

### SQL ë§ˆì´ê·¸ë ˆì´ì…˜
```
/supabase/migrations/
â”œâ”€â”€ 20250128_profile_v2_phase1.sql          # ì´ˆê¸° ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ 20250128_profile_v2_complete.sql        # í†µí•© ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ 20250807_profile_v2_achievements_improved.sql  # ì—…ì  ì‹œìŠ¤í…œ
â”œâ”€â”€ 20250807_profile_v2_achievements_fix.sql      # í•¨ìˆ˜ ì˜¤ë²„ë¡œë”© ìˆ˜ì •
â””â”€â”€ 20250807_achievement_public_wrappers.sql      # Public wrapper í•¨ìˆ˜
```

### TypeScript ì½”ë“œ
```
/src/
â”œâ”€â”€ types/profile-v2.ts              # V2 íƒ€ì… ì •ì˜
â”œâ”€â”€ hooks/features/useProfileV2.ts   # V2 Hooks
â””â”€â”€ app/test/profile-v2/            # í…ŒìŠ¤íŠ¸ í˜ì´ì§€
```

## ğŸ—‘ï¸ ì œê±° ì˜ˆì • í•­ëª© (Phase 6)

### DB í•¨ìˆ˜ (ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ 3ê°œì›” í›„)
```sql
-- í†µí•© í•¨ìˆ˜ë¡œ ëŒ€ì²´ëœ ê¸°ì¡´ í•¨ìˆ˜ë“¤
DROP FUNCTION IF EXISTS public.get_user_with_stats;
DROP FUNCTION IF EXISTS public.get_user_comprehensive_stats;
DROP FUNCTION IF EXISTS public.get_user_stats;
DROP FUNCTION IF EXISTS public.get_user_content_stats;
DROP VIEW IF EXISTS public.user_stats;
```

### ì½”ë“œ íŒŒì¼
```
/src/hooks/features/useProfile.ts    # ê¸°ì¡´ Hooks
/src/types/profile.ts                # ê¸°ì¡´ íƒ€ì…
/src/app/test/profile-v2/           # í…ŒìŠ¤íŠ¸ í˜ì´ì§€
/src/app/api/debug-profile-v2/      # ë””ë²„ê¹… API
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ì‹¤í–‰ í•„ìš” SQL (Supabase Dashboard)
```sql
-- ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•Šì€ SQL íŒŒì¼ë“¤
1. /supabase/migrations/20250807_profile_v2_achievements_improved.sql
2. /supabase/migrations/20250807_achievement_public_wrappers.sql
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] V2 ì‹œìŠ¤í…œ êµ¬ì¶•
- [x] íƒ€ì… ì •ì˜ ë° Hook ê°œë°œ
- [x] ì—…ì  ì‹œìŠ¤í…œ í†µí•©
- [x] ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì „í™˜
- [x] ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] **Supabaseì— SQL ì‹¤í–‰** âš ï¸
- [ ] í”„ë¡œë•ì…˜ ë°°í¬
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- [ ] 3ê°œì›” í›„ ê¸°ì¡´ ì‹œìŠ¤í…œ ì œê±°

## ğŸ“ˆ ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ í•„ìš”í•œ ì‘ì—…
1. **Supabase Dashboardì—ì„œ SQL ì‹¤í–‰**
   - achievements ê´€ë ¨ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì‹¤í–‰
   - íƒ€ì… ì¬ìƒì„± (`npm run db:types`)

### ìµœì í™” ì‘ì—…
1. Materialized View ìë™ ê°±ì‹  ì„¤ì •
2. ìºì‹± ì „ëµ ê°œì„ 
3. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•

### ë¬¸ì„œ ì •ë¦¬
1. ì´ ë¬¸ì„œë¥¼ ë©”ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¬¸ì„œë¡œ ìœ ì§€
2. ë‹¤ë¥¸ profile ê´€ë ¨ MD íŒŒì¼ë“¤ ì•„ì¹´ì´ë¸Œ
3. CLAUDE.md ì—…ë°ì´íŠ¸

## ğŸ”„ ë¡¤ë°± ê³„íš

ë¬¸ì œ ë°œìƒ ì‹œ:
```sql
-- V2 ì‹œìŠ¤í…œ ì™„ì „ ì œê±°
DROP SCHEMA profile_v2 CASCADE;

-- ì½”ë“œ ë¡¤ë°±
-- git revert [commit-hash]
```

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ
- CLAUDE.md - í”„ë¡œì íŠ¸ ê°€ì´ë“œ
- MIGRATION.md - ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜ í˜„í™©
- database.types.ts - ìë™ ìƒì„±ëœ íƒ€ì…

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-08-07  
**ì‘ì„±ì**: Claude Assistant  
**ê²€í†  í•„ìš”**: Supabase SQL ì‹¤í–‰ ì—¬ë¶€ í™•ì¸