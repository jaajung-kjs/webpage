# CLAUDE.md - KEPCO AI Community 프로젝트 개발 가이드

## 🚨 핵심 원칙 - 절대 위반하지 말 것

### 1. DB 수정 원칙 - "DB는 신성하다"
- **절대 DB를 먼저 수정하지 마세요**
- DB 수정이 필요하다고 생각되면:
  1. 먼저 기존 함수/스키마 전체 조사
  2. 유사한 기능이 이미 있는지 확인
  3. 정말 필요한 경우에만 수정
  4. 수정 전 반드시 영향도 분석
- **금지 사항**:
  - ❌ 비슷한 이름의 함수 중복 생성
  - ❌ v1, v2, v3... 같은 버전 네이밍
  - ❌ 기존 함수 확인 없이 새 함수 생성
  - ❌ 임시 테이블/함수 생성
- **중요**: 
  - ✅ **DB의 버그는 DB에서 해결** - 프론트엔드에서 임시방편 금지
  - ✅ **잘못된 데이터/계산은 DB 함수 수정으로 해결**

### 2. 작업 순서 - "읽기 → 분석 → 계획 → 실행"
모든 작업은 반드시 이 순서로:
1. **전체 코드베이스 파악**
   - DB 스키마 및 함수 확인
   - 백엔드 API 및 Hook 구조 파악
   - 프론트엔드 컴포넌트 의존성 확인
2. **문제 분석**
   - 정확한 원인 파악
   - 영향 범위 확인
3. **계획 수립**
   - 최소한의 수정으로 해결
   - 기존 코드 최대한 활용
4. **실행**
   - 한 번에 하나씩 수정
   - 각 수정 후 테스트

### 3. Agent 활용 - "전문가에게 맡겨라"
- 복잡한 작업은 반드시 전문 Agent 활용:
  - DB 분석: `database-optimization` agent
  - 성능 문제: `react-performance-optimization` agent
  - 디버깅: `debugger` agent
  - 코드 리뷰: `code-reviewer` agent

## 📋 개발 체크리스트

### 새 기능 추가 시
- [ ] 기존 유사 기능 있는지 확인
- [ ] DB 함수 중복 체크
- [ ] 기존 Hook 재사용 가능한지 확인
- [ ] 컴포넌트 재사용 가능한지 확인

### 버그 수정 시
- [ ] 정확한 원인 파악 (추측 금지)
- [ ] 관련 코드 전체 확인
- [ ] 최소한의 수정으로 해결
- [ ] 사이드 이펙트 확인

### DB 작업 시
- [ ] 기존 테이블/함수 전수조사
- [ ] 유사 기능 확인
- [ ] 정말 새로 만들어야 하는지 3번 확인
- [ ] 마이그레이션 영향도 분석

## 🧪 테스트 가이드

### E2E 테스트 (Playwright)
**테스트 계정**:
- Email: jaajung@naver.com
- Password: kjs487956!@

**필수 테스트 항목**:
1. **인증/권한**
   - 로그인/로그아웃
   - 권한별 접근 제어
   
2. **콘텐츠 CRUD**
   - 글쓰기 (모든 콘텐츠 타입)
   - 수정/삭제
   - 댓글 작성
   
3. **활동 기능**
   - 참여 신청
   - 참가 취소
   - 출석 체크
   
4. **프로필**
   - 프로필 페이지 데이터 확인
   - 통계 정확성
   - 하드코딩 데이터 체크
   
5. **상호작용**
   - 좋아요/북마크
   - 메시지 발송
   - 알림

### 테스트 후 확인사항
- [ ] 콘솔 에러 없음
- [ ] 네트워크 에러 없음
- [ ] 하드코딩된 데이터 없음
- [ ] 실제 DB 데이터와 일치

## 🔍 코드 일관성 체크

### 네이밍 컨벤션
- DB 함수: `snake_case` (예: `get_user_stats`)
- React 컴포넌트: `PascalCase`
- Hook: `use` 접두사 + `CamelCase`
- 파일명: 컴포넌트는 `PascalCase`, 나머지는 `kebab-case`

### 파일 구조
```
src/
├── components/     # UI 컴포넌트
├── hooks/         # Custom Hooks
│   ├── core/      # 핵심 시스템 Hook
│   └── features/  # 기능별 Hook
├── lib/           # 유틸리티 및 설정
└── app/           # Next.js 페이지
```

### Import 순서
1. React/Next.js
2. 외부 라이브러리
3. 내부 컴포넌트
4. 내부 Hook
5. 타입 정의
6. 스타일

## ⚠️ 자주 하는 실수 - 절대 하지 말 것

### DB 관련
- ❌ 확인 없이 새 함수 생성
- ❌ `_v2`, `_v3` 같은 버전 suffix 추가
- ❌ 비슷한 이름의 테이블/함수 생성
- ❌ 임시 해결책으로 DB 수정

### 프론트엔드 관련
- ❌ 하드코딩된 데이터 사용
- ❌ 에러 처리 없는 API 호출
- ❌ 중복된 Hook 생성
- ❌ any 타입 사용

### 테스트 관련
- ❌ 테스트 없이 배포
- ❌ 일부만 테스트하고 전체 동작 가정
- ❌ 콘솔 에러 무시

## 📊 현재 프로젝트 상태

### 주요 DB 함수 (중복 생성 금지!)
- `get_user_stats_v2` - 사용자 통계
- `get_user_achievements_complete` - 업적 정보
- `get_comment_tree_v2` - 댓글 트리
- `calculate_user_level_v2` - 레벨 계산
- `increment_activity_score_v2` - 활동 점수 증가

### 주요 Hook (재사용 우선!)
- `useAuthV2` - 인증 관리
- `useProfileV2` - 프로필 관리
- `useContentV2` - 콘텐츠 관리
- `useCommentsV2` - 댓글 관리
- `useAchievements` - 업적 관리

## 🎯 작업 우선순위

1. **기능 완성도** > 새 기능 추가
2. **버그 수정** > 성능 최적화
3. **기존 코드 활용** > 새 코드 작성
4. **테스트** > 추측

## 💡 문제 해결 프로세스

1. **문제 정의**: 정확히 무엇이 문제인가?
2. **원인 분석**: 왜 발생했는가? (추측 금지)
3. **해결 방안**: 가장 간단한 해결책은?
4. **영향 분석**: 다른 부분에 영향은?
5. **구현**: 최소한의 수정
6. **테스트**: E2E 테스트로 검증
7. **문서화**: 변경사항 기록

## 🚀 배포 전 체크리스트

- [ ] 모든 기능 E2E 테스트 완료
- [ ] 콘솔 에러 없음 확인
- [ ] 하드코딩 데이터 제거 확인
- [ ] DB 함수 중복 없음 확인
- [ ] 코드 리뷰 완료
- [ ] 타입 에러 없음
- [ ] 빌드 성공

---

**기억하세요**: 
- DB는 최적화된 상태를 유지
- 기존 코드를 최대한 활용
- 테스트로 검증된 것만 배포
- 전문 Agent 적극 활용